{% extends "base.html" %}
{% block content %}
<div class="detail-wrap">
  <div class="detail-card">
    <h2>{{ site["name"] }} <small>#{{ site["id"] }}</small></h2>
    <form action="{{ url_for('edit_site', site_id=site['id']) }}" method="post" class="edit-form">
      <label>Site Name</label>
      <input name="name" value="{{ site['name'] or '' }}">
      <label>Job #</label>
      <input name="job_number" value="{{ site['job_number'] or '' }}">
      <label>Customer</label>
      <input name="customer" value="{{ site['customer'] or '' }}">
      <label>Description / Notes</label>
      <textarea name="description" rows="4">{{ site['description'] or '' }}</textarea>
      <div class="coords">
        <div><label>Latitude</label><input name="latitude" value="{{ site['latitude'] }}"></div>
        <div><label>Longitude</label><input name="longitude" value="{{ site['longitude'] }}"></div>
      </div>
      <div class="btnrow">
        <button type="submit">Save Changes</button>
        <button form="deleteForm" class="danger">Delete Site</button>
      </div>
    </form>
    <form id="deleteForm" action="{{ url_for('delete_site', site_id=site['id']) }}" method="post"></form>
  </div>

  <div class="gallery-card">
    <h3>Photos</h3>
    <form action="{{ url_for('upload_photo', site_id=site['id']) }}" method="post" enctype="multipart/form-data" class="upload-form">
      <input type="file" name="photo" accept="image/*" required>
      <input type="text" name="caption" placeholder="Add a caption (optional)">
      <button type="submit">Upload</button>
    </form>
    {% if photos %}
      <div class="photos">
        {% for p in photos %}
        <figure>
          <img src="{{ url_for('serve_upload', filename=p['filename']) }}" alt="photo">
          <figcaption>{{ p['caption'] or '' }} <small>{{ p['created_at'] }}</small></figcaption>
        </figure>
        {% endfor %}
      </div>
    {% else %}<p>No photos yet.</p>{% endif %}
  </div>

  <div class="notes-card">
    <h3>Notes</h3>
    <form action="{{ url_for('add_note', site_id=site['id']) }}" method="post" class="note-form">
      <textarea name="body" rows="2" placeholder="Add a note..."></textarea>
      <button type="submit">Add</button>
    </form>
    {% if notes %}
      <ul class="notes">
        {% for n in notes %}<li><span class="ts">{{ n['created_at'] }}</span> â€” {{ n['body'] }}</li>{% endfor %}
      </ul>
    {% else %}<p>No notes yet.</p>{% endif %}
  </div>
</div>
{% endblock %}
